<%- include('partials/header', { pageTitle: pageTitle }) %>

<h1><%= t('auth.login_title') %></h1>

<% if (locals.resetSuccess) { %>
    <p class="feedback-message success">Votre mot de passe a été réinitialisé avec succès ! Vous pouvez maintenant vous connecter.</p>
<% } %>

<% if (error) { %>
    <p class="error-message"><%= error %></p>
<% } %>

<form action="/connexion" method="POST">
    <div class="form-group">
        <label for="username"><%= t('forms.username') %> :</label><br>
        <input type="text" id="username" name="username" required>
    </div>
    <div class="form-group password-container">
        <label for="password"><%= t('forms.password') %> :</label><br>
        <div style="position: relative;">
            <input type="password" id="password" name="password" required>
            <i class="fas fa-eye toggle-password-icon" id="togglePassword"></i>
        </div>
    </div>
    <div>
        <button type="submit"><%= t('forms.login_button') %></button>
    </div>
</form>

<p style="margin-top: 1rem;"><a href="/forgot-password"><%= t('auth.forgot_password_link') %></a></p>

<% if (!adminExists) { %>
    <p><%= t('auth.no_admin') %> <a href="/inscription"><%= t('auth.create_now') %></a>.</p>
<% } %>

<%- include('partials/footer') %>

<script>
    const passwordInput = document.getElementById('password');
    const togglePasswordIcon = document.getElementById('togglePassword');

    if (passwordInput && togglePasswordIcon) {
        togglePasswordIcon.addEventListener('click', function() {
            const currentType = passwordInput.getAttribute('type');
            if (currentType === 'password') {
                passwordInput.setAttribute('type', 'text');
                this.classList.remove('fa-eye');
                this.classList.add('fa-eye-slash');
            } else {
                passwordInput.setAttribute('type', 'password');
                this.classList.remove('fa-eye-slash');
                this.classList.add('fa-eye');
            }
        });
    }
</script>