<%- include('partials/header', { pageTitle: pageTitle }) %>

<% if (locals.resetSuccess) { %>
    <p class="feedback-message success">Votre mot de passe a été réinitialisé avec succès ! Vous pouvez maintenant vous connecter.</p>
<% } %>

<h1><%= t('auth.login_title') %></h1>

<% if (error) { %>
    <p class="error-message"><%= error %></p>
<% } %>

<form action="/connexion" method="POST">
    <div>
        <label for="username"><%= t('forms.username') %> :</label><br>
        <input type="text" id="username" name="username" required>
    </div>
    
    <div class="form-group password-container"> <label for="password"><%= t('forms.password') %> :</label><br>
        <div style="position: relative;"> <input type="password" id="password" name="password" required>
            <button type="button" id="togglePassword" class="toggle-password-btn">Voir</button>
        </div>
    </div>

    <div>
        <button type="submit"><%= t('forms.login_button') %></button>
    </div>
</form>
<p style="margin-top: 1rem;"><a href="/forgot-password">Mot de passe oublié ?</a></p> <% if (!adminExists) { /* ... Create account link ... */ } %>

<% if (!adminExists) { %>
    <p><%= t('auth.no_admin') %> <a href="/inscription"><%= t('auth.create_now') %></a>.</p>
<% } %>

<script>
    const passwordInput = document.getElementById('password');
    const togglePasswordBtn = document.getElementById('togglePassword');

    if (passwordInput && togglePasswordBtn) {
        togglePasswordBtn.addEventListener('click', function() {
            // Bascule le type de l'input entre 'password' et 'text'
            const currentType = passwordInput.getAttribute('type');
            if (currentType === 'password') {
                passwordInput.setAttribute('type', 'text');
                this.textContent = 'Cacher'; // Change le texte du bouton
            } else {
                passwordInput.setAttribute('type', 'password');
                this.textContent = 'Voir'; // Remet le texte initial
            }
        });
    }
</script>

<%- include('partials/footer') %>