<%- include('partials/header', { pageTitle: pageTitle }) %>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<div class="static-page full-width-container">
    <div style="text-align: center; margin-bottom: 2rem;">
        <h1><i class="fas fa-plane-departure"></i> <%= t('nav.journal') %> - Travel Map</h1>
        <p>Suivez mon aventure étape par étape.</p>
    </div>
    
    <% 
        // On construit le tableau JSON pour la carte
        const locations = articles.filter(a => a.lat && a.lng).map(a => ({
            lat: a.lat,
            lng: a.lng,
            title: a.title,
            icon: 'fa-book' // Icône par défaut
        }));
    %>

    <div class="school-interactive-grid">
        
        <div class="map-column-sticky">
            <div id="map" data-locations='<%= JSON.stringify(locations) %>'></div>

            <div class="map-navigation">
                <button id="prev-step-btn" class="nav-arrow-btn" disabled>
                    <i class="fas fa-chevron-left"></i> Précédent
                </button>
                <span id="step-indicator">-- / --</span>
                <button id="next-step-btn" class="nav-arrow-btn">
                    Suivant <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>

        <div class="timeline-column">
            <div class="timeline">
                
                <% let stepIndex = 0; %>
                <% articles.forEach((article) => { %>
                    
                    <% const hasLoc = (article.lat && article.lng); %>
                    <% const stepId = hasLoc ? `step-${stepIndex}` : ''; %>
                    <% if (hasLoc) stepIndex++; %>

                    <div class="timeline-item reveal <%= hasLoc ? 'has-location' : '' %>" id="<%= stepId %>">
                        <div class="timeline-icon" style="<%= hasLoc ? 'background:var(--c-primary); color:white;' : 'background:var(--c-surface); color:var(--c-text-light); border-color:var(--c-border);' %>">
                            <i class="fas <%= hasLoc ? 'fa-map-marker-alt' : 'fa-pen' %>"></i>
                        </div>
                        
                        <div class="timeline-content">
                            <h2><a href="/entree/<%= article.id %>"><%= article.title %></a></h2>
                            <span class="timeline-date">
                                <%= new Date(article.publication_date).toLocaleDateString(i18n.language, { day: 'numeric', month: 'long', year: 'numeric' }) %>
                            </span>
                            
                            <% if (article.summary) { %>
                                <p style="font-style: italic; margin-bottom: 10px;"><%= article.summary %></p>
                            <% } %>

                            <% if (article.cover_image_url) { %>
                                <a href="/entree/<%= article.id %>">
                                    <img src="<%= article.cover_image_url %>" alt="" style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px;">
                                </a>
                            <% } %>
                            
                            <div style="margin-top: 10px;">
                                <a href="/entree/<%= article.id %>" class="btn-text">Lire l'article &rarr;</a>
                            </div>
                        </div>
                    </div>
                <% }); %>

            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="/js/map.js"></script>
<script src="/js/scroll-reveal.js"></script>

<%- include('partials/footer') %>