<%- include('partials/header', { pageTitle: pageTitle }) %>

<div class="static-page">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h1 style="margin: 0; border: none;"><i class="fas fa-clipboard-list"></i> <%= t('security.audit_title') || "Journal d'Audit" %></h1>
        <a href="/admin/audit" class="btn-text"><i class="fas fa-sync-alt"></i> Actualiser</a>
    </div>

    <p class="feedback-message info" style="display: block; background: var(--c-background); border-color: var(--c-border); color: var(--c-text-light);">
        <i class="fas fa-info-circle"></i> Ce journal enregistre les actions sensibles (connexions, suppressions, modifications) par sécurité.
    </p>

    <div class="table-wrapper">
        <table class="tags-table" style="width: 100%;">
            <thead>
                <tr>
                    <th style="width: 15%">Date</th>
                    <th style="width: 15%">Utilisateur</th>
                    <th style="width: 20%">Action</th>
                    <th style="width: 35%">Détails</th>
                    <th style="width: 15%; text-align: right;">IP</th>
                </tr>
            </thead>
            <tbody>
                <% if (logs && logs.length > 0) { %>
                    <% logs.forEach(log => { %>
                        <% 
                           // Petite logique pour colorer les actions critiques
                           let color = "var(--c-text)";
                           if (log.action.includes('DELETE') || log.action.includes('FAILED')) color = "var(--c-danger)";
                           if (log.action.includes('LOGIN_SUCCESS')) color = "var(--c-success)";
                           if (log.action.includes('RESTORE') || log.action.includes('2FA')) color = "#f39c12"; // Orange
                        %>
                        <tr>
                            <td data-label="Date">
                                <small><%= new Date(log.created_at).toLocaleString() %></small>
                            </td>

                            <td data-label="Utilisateur">
                                <% if (log.username) { %>
                                    <strong><%= log.username %></strong>
                                <% } else { %>
                                    <em style="color: var(--c-text-light);">Système/Invité</em>
                                <% } %>
                            </td>

                            <td data-label="Action">
                                <span style="font-weight: bold; color: <%= color %>;">
                                    <%= log.action %>
                                </span>
                            </td>

                            <td data-label="Détails" style="word-break: break-word;">
                                <%= log.details %>
                            </td>

                            <td data-label="IP" style="text-align: right; font-family: monospace;">
                                <%= log.ip_address || 'N/A' %>
                            </td>
                        </tr>
                    <% }); %>
                <% } else { %>
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 2rem;">Aucun journal d'activité pour le moment.</td>
                    </tr>
                <% } %>
            </tbody>
        </table>
    </div>

    <div style="margin-top: 2rem;">
        <a href="/admin/dashboard" class="btn-text">&larr; Retour au Tableau de Bord</a>
    </div>
</div>

<%- include('partials/footer') %>