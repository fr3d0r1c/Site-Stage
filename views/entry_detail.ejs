<%- include('partials/header', { pageTitle: pageTitle }) %>

<% if (locals.message) { %>
    <p class="<%= message.type === 'success' ? 'feedback-message success' : 'error-message' %>" 
       style="display: none;"
       data-detail="<%= message.detail || '' %>">
        <%= message.text %>
    </p>
<% } %>

<article class="full-article">
    <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1><%= article.title %></h1>
            <button id="zen-mode-btn" class="btn btn-secondary" title="Mode Lecture Zen" style="border-radius: 50%; width: 40px; height: 40px; padding: 0; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-book-open"></i>
            </button>
    </div>
    
    <small><%= t('journal.published_on') %>: <%= new Date(article.publication_date).toLocaleString(i18n.language) %></small>

    <% if (article.tags && article.tags.length > 0) { %>
        <div class="tags-list entry-tags">
            <% article.tags.forEach(tag => { %>
                <a href="/tags/<%= tag %>" class="tag-item"><%= tag %></a>
            <% }); %>
        </div>
    <% } %>

    <hr>
    
    <div class="article-content"><%- article.content %></div>

    <% if (locals.username) { %>
         <div class="actions" style="margin-top: 2rem; border-top: 1px solid var(--c-border); padding-top: 1.5rem;">
             <a href="/entree/<%= article.id %>/edit"><%= t('journal.edit') %></a>
             <form action="/entree/<%= article.id %>/delete" method="POST" 
                   data-confirm="<%= t('admin_page.delete_confirm', 'Voulez-vous vraiment supprimer cette entrée ?') %>" 
                   style="display: inline;">
                 <button type="submit"><%= t('journal.delete') %></button>
             </form>
         </div>
     <% } %>

</article>

<nav class="prev-next-nav">
    <div class="prev-link">
        <% if (prevEntry) { %>
            <a href="/entree/<%= prevEntry.id %>" title="<%= prevEntry.title %>">
                <small>&larr; <%= t('journal.prev_entry') %></small>
                <span class="prev-next-title"><%= prevEntry.title %></span>
            </a>
        <% } %>
    </div>
    <div class="next-link">
        <% if (nextEntry) { %>
            <a href="/entree/<%= nextEntry.id %>" title="<%= nextEntry.title %>">
                <small><%= t('journal.next_entry') %> &rarr;</small>
                <span class="prev-next-title"><%= nextEntry.title %></span>
            </a>
        <% } %>
    </div>
</nav>

<hr>

<section class="comments-section">
    <h2><%= t('comments.title') %> (<%= comments.length %>)</h2>

    <% if (typeof messageSent !== 'undefined') { %>
        <% if (messageSent === true) { %>
            <p class="feedback-message success" style="display: none;">
                Votre commentaire a été publié ! <%# Ou t('comments.success_message') %>
            </p>
        <% } else if (messageSent === false) { %>
            <p class="error-message" style="display: none;">
                Une erreur s'est produite lors de l'envoi du commentaire.
            </p>
        <% } %>
    <% } %>

    <div class="comments-list">
        <% if (comments && comments.length > 0) { %>
            <% comments.forEach(comment => { %>
                <div class="comment-item">
                    <div class="comment-header">
                        <strong><%= comment.author_name || t('comments.anonymous') %></strong>
                        <small><%= new Date(comment.created_at).toLocaleString(i18n.language) %></small>
                    </div>
                    <div class="comment-body">
                        <p><%= comment.content %></p>
                    </div>
                </div>
            <% }); %>
        <% } else { %>
            <p><i><%= t('comments.no_comments') %></i></p>
        <% } %>
    </div>

    <div class="comment-form">
        <h3><%= t('comments.leave_comment') %></h3>
        <form action="/article/<%= article.id %>/comment" method="POST">
            <div class="form-group">
                <label for="author_name"><%= t('comments.form_name') %> :</label>
                <input type="text" id="author_name" name="author_name" required>
            </div>
            <div class="form-group">
                <label for="comment_content"><%= t('comments.form_comment') %> :</label>
                <textarea id="comment_content" name="content" rows="5" required></textarea>
            </div>
            
            <div class="form-group honeypot">
                <label for="website-field">Ne pas remplir ce champ</label>
                <input type="text" id="website-field-comment" name="website_field" autocomplete="off" tabindex="-1">
            </div>

            <div>
                <button type="submit"><%= t('comments.submit_button') %></button>
            </div>
        </form>
    </div>
</section>
<nav style="margin-top: 2rem;">
    <a href="/journal"><%= t('journal.back_to_journal') %></a>
</nav>

<%- include('partials/footer') %>