<%- include('partials/header', { pageTitle: pageTitle }) %>

<h1><%= t('nav.journal') %></h1>

<div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; margin-top: 1.5rem;">
    <div class="journal-actions" style="display: flex; gap: 0.5rem;">
        <% if (locals.username) { %>
            <a href="/journal/nouvelle" class="btn">
                <i class="fas fa-plus-circle"></i> <%= t('journal.add_entry') %>
            </a>
        <% } %>
        <a href="/" class="btn btn-secondary">
            <i class="fas fa-home"></i> <%= t('nav.home') %>
        </a>
    </div>

    <div class="sort-container" style="margin: 0;">
        <form action="/journal" method="GET" id="sort-form" style="display: flex; align-items: center; gap: 0.5rem;">
            <label for="sort-select" style="margin-bottom: 0; color: var(--c-text-light);"><i class="fas fa-sort"></i> Trier par :</label>
            <select name="sort" id="sort-select" style="width: auto; padding: 8px 12px;">
                <option value="date_desc" <%= currentSort === 'date_desc' ? 'selected' : '' %>>Date (Plus récent)</option>
                <option value="date_asc" <%= currentSort === 'date_asc' ? 'selected' : '' %>>Date (Plus ancien)</option>
                <option value="alpha_asc" <%= currentSort === 'alpha_asc' ? 'selected' : '' %>>Titre (A-Z)</option>
                <option value="alpha_desc" <%= currentSort === 'alpha_desc' ? 'selected' : '' %>>Titre (Z-A)</option>
                <option value="tag_asc" <%= currentSort === 'tag_asc' ? 'selected' : '' %>>Tag (A-Z)</option>
                <option value="tag_desc" <%= currentSort === 'tag_desc' ? 'selected' : '' %>>Tag (Z-A)</option>
            </select>
            <% if (typeof currentTag !== 'undefined' && currentTag) { %>
                <input type="hidden" name="tag" value="<%= currentTag %>">
            <% } %>
        </form>
    </div>

</div>
<hr>

<div class="entries-grid">
    <% if (articles.length > 0) { %>
        <% articles.forEach(entry => { %>
            <article class="entry-card reveal">
                <% if (entry.coverImage) { %>
                    <a href="/entree/<%= entry.id %>" class="card-image-link">
                        <img src="<%= entry.coverImage %>" alt="<%= entry.title %>" class="cover-image" loading="lazy">
                    </a>
                <% } %>
                <div class="card-body">
                    <h2>
                        <% if (entry.is_pinned) { %>
                            <i class="fas fa-thumbtack" style="color: var(--c-primary); font-size: 0.8em; margin-right: 5px;" title="Épinglé"></i>
                        <% } %>
                        
                        <a href="/entree/<%= entry.id %>"><%= entry.title %></a>

                        <% if (entry.status === 'draft') { %>
                            <span class="badge-draft"><i class="fas fa-pencil-ruler"></i> Brouillon</span>
                        <% } %>
                    </h2>

                    <div style="font-size: 0.85rem; color: var(--c-text-light); margin-bottom: 10px;">
                        <i class="far fa-calendar-alt"></i> <%= new Date(entry.publication_date).toLocaleDateString(i18n.language) %>
                        &nbsp; | &nbsp;
                        <i class="far fa-clock"></i> <%= entry.readingTime %> <%= t('general.min_read') %>
                    </div>
                    
                    <% if (entry.tags && entry.tags.length > 0) { %>
                        <div class="tags-list">
                            <% entry.tags.forEach(tag => { %>
                                <a href="/tags/<%= tag %>" class="tag-item"><%= tag %></a>
                            <% }); %>
                        </div>
                    <% } %>
                    
                    <p><%= entry.excerpt %> <a href="/entree/<%= entry.id %>"><%= t('journal.read_more') %></a></p>

                    <% if (locals.username) { %>
                        <div class="actions">
                            <a href="/entree/<%= entry.id %>/edit"><%= t('journal.edit') %></a>
                            <form action="/entree/<%= entry.id %>/delete" method="POST" 
                                  data-confirm="<%= t('admin_page.delete_confirm') %>"
                                  style="display: inline;">
                                <button type="submit"><%= t('journal.delete') %></button>
                            </form>
                        </div>
                    <% } %>
                </div>
            </article>
        <% }); %>
    <% } else { %>
        <p>Aucune entrée trouvée.</p>
    <% } %>
</div>

<% if (totalPages > 1) { %>
    <div class="pagination" aria-label="Pagination">
        <ul></ul>
            <% if (currentPage > 1) { %>
                <li><a href="<%= baseUrl %>?page=<%= currentPage - 1 %><%= sortParam %>">&laquo;</a></li>
            <% } else { %>
                <li class="disabled"><span>&laquo;</span></li>
            <% } %>

            <% for(let i = 1; i <= totalPages; i++) { %>
                <li class="<%= currentPage === i ? 'active' : '' %>">
                    <a href="<%= baseUrl %>?page=<%= i %><%= sortParam %>"><%= i %></a>
                </li>
            <% } %>

            <% if (currentPage < totalPages) { %>
                <li><a href="<%= baseUrl %>?page=<%= currentPage + 1 %><%= sortParam %>">&raquo;</a></li>
            <% } else { %>
                <li class="disabled"><span>&raquo;</span></li>
            <% } %>
        </ul>
    </div>
<% } %>

<%- include('partials/footer') %>