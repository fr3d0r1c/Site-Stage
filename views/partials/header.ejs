<!DOCTYPE html>
<html lang="<%= i18n.language %>">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= pageTitle %> | <%= t('general.logo') %></title>

    <meta name="description" content="<%= locals.ogDescription || t('general.default_og_description') %>">
    <meta property="og:title" content="<%= locals.ogTitle || pageTitle %>">
    <meta property="og:description" content="<%= locals.ogDescription || t('general.default_og_description') %>">
    <meta property="og:type" content="<%= locals.ogType || 'website' %>">
    <meta property="og:image" content="<%= locals.ogImage || 'https://mon-stage-au-nom-de-pays.onrender.com/default-banner.png' %>">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="<%= locals.ogTitle || pageTitle %>">
    <meta name="twitter:description" content="<%= locals.ogDescription || t('general.default_og_description') %>">
    <meta name="twitter:image" content="<%= locals.ogImage || 'https://mon-stage-au-nom-de-pays.onrender.com/default-banner.png' %>">

    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicons/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="mask-icon" href="/images/favicons/safari-pinned-tab.svg" color="#0056b3">
    <meta name="msapplication-TileColor" content="#0056b3">
    <meta name="theme-color" content="#ffffff">

    <link rel="alternate" type="application/rss+xml" title="Flux RSS - Carnet de Stage" href="/feed.xml" />

    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/7.2.1/css/flag-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    
    <% if (activePage === 'journal' || activePage === 'admin') { %>
        <link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <% } %>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="/js/pwa-init.js"></script>
</head>
<body>
    <div class="preloader" id="preloader">
        <div class="spinner"></div>
    </div>

    <header class="site-header">
        <div class="logo">
            <a href="/">
                <img src="/images/logo.png" alt="<%= t('general.logo') %>" class="site-logo">
            </a>
        </div>

        <nav class="main-nav">
            <ul>
                <li>
                    <a href="/" class="<%= activePage === 'accueil' ? 'active' : '' %>">
                        <i class="fas fa-home"></i> <%= t('nav.home') %>
                    </a>
                </li>

                <li class="dropdown <%= (activePage === 'profil') ? 'active-parent' : '' %>">
                    <a href="#" class="dropdown-toggle">
                        <i class="fas fa-user"></i> <%= t('nav.profile') %> <i class="fas fa-caret-down fa-xs"></i>
                    </a>
                    <ul class="sous-menu">
                        <li><a href="/profil/qui-suis-je"><i class="fas fa-id-card"></i> <%= t('subnav.who_am_i') %></a></li>
                        <li><a href="/profil/parcours-scolaire"><i class="fas fa-graduation-cap"></i> <%= t('subnav.school_path') %></a></li>
                        <li><a href="/profil/parcours-pro"><i class="fas fa-briefcase"></i> <%= t('subnav.work_path') %></a></li>
                    </ul>
                </li>

                <li class="dropdown <%= (activePage === 'stage') ? 'active-parent' : '' %>">
                    <a href="#" class="dropdown-toggle">
                        <i class="fas fa-building"></i> <%= t('nav.internship') %> <i class="fas fa-caret-down fa-xs"></i>
                    </a>
                    <ul class="sous-menu">
                        <li><a href="/stage/l-entreprise"><i class="fas fa-city"></i> <%= t('subnav.company') %></a></li>
                        <li><a href="/stage/mes-missions"><i class="fas fa-tasks"></i> <%= t('subnav.missions') %></a></li>
                    </ul>
                </li>

                <li class="dropdown <%= (activePage === 'journal' || activePage === 'search') ? 'active-parent' : '' %>">
                    <a href="/journal" class="dropdown-toggle <%= activePage === 'journal' ? 'active' : '' %>">
                        <i class="fas fa-book-open"></i> <%= t('nav.journal') %> <i class="fas fa-caret-down fa-xs"></i>
                    </a>
                    <ul class="sous-menu">
                        <li><a href="/journal"><i class="fas fa-list"></i> <%= t('journal.view_all') %></a></li>
                        <li><a href="/search"><i class="fas fa-search"></i> <%= t('journal.advanced_search') %></a></li>

                        <% if (locals.username) { %>
                            <li class="dropdown dropdown-level-2">
                                <a href="#" class="dropdown-toggle">
                                    <i class="fas fa-pen-nib"></i> <%= t('editor.title') %> <i class="fas fa-caret-right fa-xs"></i>
                                </a>
                                <ul class="sous-menu">
                                    <li><a href="/journal/nouvelle"><i class="fas fa-plus"></i> <%= t('editor.create') %></a></li>
                                    <li><a href="/journal"><i class="fas fa-edit"></i> <%= t('editor.modify') %></a></li>
                                    <li><a href="/journal"><i class="fas fa-trash"></i> <%= t('editor.delete') %></a></li>
                                </ul>
                            </li>
                        <% } %>
                        <li><a href="/chronologie"><i class="fas fa-history"></i> Chronologie</a></li>
                    </ul>
                </li>

                <li>
                    <a href="/contact" class="<%= activePage === 'contact' ? 'active' : '' %>">
                        <i class="fas fa-envelope"></i> <%= t('page_titles.contact') %>
                    </a>
                </li>

                <% if (locals.username) { %>

                    <li class="dropdown <%= activePage === 'admin' ? 'active-parent' : '' %>">
                        <a href="/admin" class="dropdown-toggle <%= activePage === 'admin' ? 'active' : '' %>">
                            <i class="fas fa-user-shield"></i> <%= t('nav.admin') %> <i class="fas fa-caret-down fa-xs"></i>
                        </a>
                        <ul class="sous-menu">
                            <li><a href="/admin/dashboard"><i class="fas fa-chart-line"></i> Tableau de Bord</a></li>
                            <li><a href="/admin/tags"><i class="fas fa-tags"></i> <%= t('admin_page.manage_tags_title') %></a></li>
                            <li><a href="/admin/comments"><i class="fas fa-comments"></i> <%= t('admin_page.action_manage_comments') %></a></li>
                            <li><a href="/admin/2fa"><i class="fas fa-shield-alt"></i> Sécurité 2FA</a></li>
                            <li><a href="/admin/audit"><i class="fas fa-clipboard-list"></i> <%= t('security.audit_title') || "Journal d'Audit" %></a></li>
                            <li><a href="/admin/export/pdf" target="_blank"><i class="fas fa-file-pdf"></i> <%= t('dashboard.download_pdf') %></a></li>
                            <li><a href="/change-password"><i class="fas fa-key"></i> <%= t('admin_page.action_change_password') %></a></li>
                            <li><a href="/admin/newsletter"><i class="fas fa-bullhorn"></i> Newsletter</a></li>
                            <li><a href="/deconnexion" data-confirm="<%= t('nav.logout') %> ?"><i class="fas fa-sign-out-alt"></i> <%= t('admin_page.action_logout') %></a></li>
                        </ul>
                    </li>

                <% } else { %>

                    <li>
                        <a href="/guest/login" class="<%= activePage === 'guest' ? 'active' : '' %>">
                            <i class="fas fa-user-astronaut"></i> Espace Invité
                        </a>
                    </li>

                <% } %>
            </ul>
        </nav>

        <div class="header-controls">
            <div id="language-switcher" class="language-switcher">
                <a href="?lng=fr" title="Français" style="opacity: <%= i18n.language === 'fr' ? '1' : '0.6' %>;"><span class="fi fi-fr"></span></a>
                <span style="color: var(--c-border);">|</span>
                <a href="?lng=en" title="English" style="opacity: <%= i18n.language === 'en' ? '1' : '0.6' %>;"><span class="fi fi-gb"></span></a>
            </div>
            <button class="nav-toggle" aria-label="Ouvrir le menu de navigation" aria-expanded="false">
                <span class="hamburger"></span>
            </button>
        </div>
    </header>
    <div class="container">
        <% if (locals.message) { %>
            <p class="<%= message.type === 'success' ? 'feedback-message success' : 'error-message' %>" 
                style="display: none;"
                data-detail="<%= message.detail || '' %>">
                <%= message.text %>
            </p>
        <% } %>
    