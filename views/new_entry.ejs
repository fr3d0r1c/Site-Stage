<%- include('partials/header', { pageTitle: pageTitle }) %>

<h1><%= t('journal.add_entry') %></h1>

<form action="/journal" method="POST" id="entry-form"> <div class="title-layout">
        <div class="title-field">
            <label for="title_fr"><%= t('forms.title_fr') %> :</label><br>
            <input type="text" id="title_fr" name="title_fr" required>
        </div>
        <div class="title-field">
            <label for="title_en"><%= t('forms.title_en') %> :</label><br>
            <input type="text" id="title_en" name="title_en" required readonly> </div>
    </div>
    <hr>

    <div class="dual-editor-layout">
        <div style="flex: 1;">
            <label for="summary_fr"><%= t('forms.summary_fr') %> :</label><br>
            <textarea id="summary_fr" name="summary_fr" rows="3" placeholder="Un court texte d'accroche..."><%= (typeof article !== 'undefined' && article.summary_fr) ? article.summary_fr : '' %></textarea>
        </div>
        <div style="flex: 1;">
            <label for="summary_en"><%= t('forms.summary_fr') %> :</label><br>
            <textarea id="summary_en" name="summary_en" rows="3" placeholder="A short summary..."><%= (typeof article !== 'undefined' && article.summary_en) ? article.summary_en : '' %></textarea>
        </div>
    </div>
    <hr>

    <div class="editor-container-main">

        <div class="editor-and-preview-fr">
            <div class="editor-pane">
                <label for="content-editor-fr"><%= t('forms.content_fr') %> :</label><br>
                <textarea id="content-editor-fr" name="content_fr" rows="20"></textarea> </div>
            <div class="preview-pane">
                <label><%= t('general.preview') %> (FR) :</label><br>
                <div id="preview_fr" class="article-content"></div>
            </div>
        </div>

        <div class="preview-pane-en-standalone">
            <label><%= t('general.preview') %> (EN) (Auto):</label><br>
            <div id="preview_en" class="article-content"></div>
        </div>

    </div> <hr>

    <label for="content_en" class="visually-hidden">Contenu Anglais (Traduction)</label>
    <textarea id="content_en" name="content_en" style="display: none;" required><%= (typeof article !== 'undefined' && article.content_en) ? article.content_en : '' %></textarea>
    <hr>

    <input type="file" id="image-upload-input" style="display: none;" accept="image/*">

    <div>
        <label for="cover_image_url"><%= t('forms.cover_image_url') %> :</label><br>
        <input type="text" id="cover_image_url" name="cover_image_url" placeholder="Collez l'URL d'une image ici...">
        <small><%= t('forms.cover_image_hint') %></small>
    </div>

    <div>
        <div class="tags-label-container">
            <label>Tags :</label>
            <button type="button" id="open-tag-modal-btn" class="add-tag-btn" title="<%= t('admin_page.add_new_tag_title') %>">+</button>
        </div>
        <div class="tags-checkbox-list">
            <% if (allTags && allTags.length > 0) { %>
                <% allTags.forEach(tag => { %>
                    <div class="tag-checkbox-item">
                        <input
                            type="checkbox"
                            name="tags"
                            value="<%= tag.id %>"
                            id="tag-<%= tag.id %>"
                            <%# Pas de 'checked' pour une nouvelle entrée %>
                        >
                        <label for="tag-<%= tag.id %>"><%= tag.name %></label>
                    </div>
                <% }); %>
            <% } else { %>
                <p><i><%= t('admin_page.no_tags') %> Cliquez sur <button type="button" id="open-tag-modal-btn" class="add-tag-btn" title="<%= t('admin_page.add_new_tag_title') %>">+</button> Pour en créer. </i></p>
            <% } %>
        </div>
    </div>

    <div>
        <button type="submit" id="submit-button"><%= t('forms.create_entry') %></button>
        <a href="/journal" class="btn button-secondary" 
           data-confirm="Êtes-vous sûr de vouloir annuler ? Toutes les modifications non sauvegardées seront perdues."><%= t('general.cancel') %></a>
    </div>
</form>

<div id="tag-modal-overlay" class="modal-overlay">
    <div id="tag-modal-content" class="modal-content static-page">
        <button id="close-tag-modal-btn" class="modal-close-btn">&times;</button>
        <h2><%= t('admin_page.add_new_tag_title') %></h2>
        
        <form id="new-tag-form">
            <div class="form-group">
                <label for="new_tag_name_fr"><%= t('admin_page.tag_name_fr') %> :</label>
                <input type="text" id="new_tag_name_fr" name="name_fr" required>
            </div>
            <div class="form-group">
                <label for="new_tag_name_en"><%= t('admin_page.tag_name_en') %> :</label>
                <input type="text" id="new_tag_name_en" name="name_en">
                <small>Laissez vide pour auto-traduction (si DeepL est configuré).</small>
            </div>
            <div>
                <button type="submit" id="create-tag-submit-btn"><%= t('admin_page.add_tag_button') %></button>
            </div>
            <div id="tag-modal-error" style="color: var(--c-danger); display: none; margin-top: 1rem; font-weight: bold;"></div>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>

<script src="/js/auto-translate-preview.js"></script> 
<script src="/js/init-easymde.js"></script>          

<script src="/js/uploader.js"></script>
<script src="/js/modal-tag-handler.js"></script>
<script src="/js/form-validation.js"></script>

<%- include('partials/footer') %>